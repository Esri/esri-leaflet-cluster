{"version":3,"file":"esri-leaflet-cluster.js","sources":["../package.json","../src/ClusteredFeatureLayer.js"],"sourcesContent":["{\n  \"name\": \"esri-leaflet-cluster\",\n  \"description\": \"Esri Leaflet plugin for visualizing Feature Layers as clusters with L.markercluster.\",\n  \"version\": \"2.0.0\",\n  \"author\": \"Patrick Arlt <parlt@esri.com> (http://patrickarlt.com)\",\n  \"contributors\": [\n    \"Patrick Arlt <parlt@esri.com> (http://patrickarlt.com)\",\n    \"John Gravois <jgravois@esri.com> (http://johngravois.com)\"\n  ],\n  \"dependencies\": {\n    \"esri-leaflet\": \"^2.0.0\",\n    \"leaflet\": \"^1.0.0-rc.3\",\n    \"leaflet.markercluster\": \"git+https://github.com/Leaflet/Leaflet.markercluster.git#v1.0.0-rc.1\"\n  },\n  \"devDependencies\": {\n    \"chai\": \"2.3.0\",\n    \"gh-release\": \"^2.0.0\",\n    \"http-server\": \"^0.8.5\",\n    \"isparta\": \"^3.0.3\",\n    \"istanbul\": \"^0.4.2\",\n    \"karma\": \"^0.12.24\",\n    \"karma-chai-sinon\": \"^0.1.3\",\n    \"karma-coverage\": \"^0.5.3\",\n    \"karma-mocha\": \"^0.1.0\",\n    \"karma-mocha-reporter\": \"^0.2.5\",\n    \"karma-phantomjs-launcher\": \"^0.1.4\",\n    \"karma-sourcemap-loader\": \"^0.3.5\",\n    \"mkdirp\": \"^0.5.1\",\n    \"node-sass\": \"^3.2.0\",\n    \"phantomjs\": \"^1.9.17\",\n    \"rollup\": \"^0.25.4\",\n    \"rollup-plugin-json\": \"^2.0.0\",\n    \"rollup-plugin-node-resolve\": \"^1.4.0\",\n    \"rollup-plugin-uglify\": \"^0.3.1\",\n    \"semistandard\": \"^7.0.4\",\n    \"sinon\": \"^1.11.1\",\n    \"sinon-chai\": \"2.7.0\",\n    \"snazzy\": \"^2.0.1\",\n    \"watch\": \"^0.17.1\"\n  },\n  \"homepage\": \"https://github.com/Esri/esri-leaflet-cluster\",\n  \"jsnext:main\": \"src/ClusteredFeatureLayer.js\",\n  \"jspm\": {\n    \"registry\": \"npm\",\n    \"format\": \"es6\",\n    \"main\": \"src/ClusteredFeatureLayer.js\"\n  },\n  \"keywords\": [\n    \"arcgis\",\n    \"esri\",\n    \"esri leaflet\",\n    \"gis\",\n    \"leaflet plugin\",\n    \"mapping\"\n  ],\n  \"license\": \"Apache-2.0\",\n  \"main\": \"dist/esri-leaflet-cluster-debug.js\",\n  \"readmeFilename\": \"README.md\",\n  \"repository\": {\n    \"type\": \"git\",\n    \"url\": \"git+https://github.com/Esri/esri-leaflet-cluster.git\"\n  },\n  \"scripts\": {\n    \"prebuild\": \"mkdirp dist\",\n    \"build\": \"rollup -c profiles/debug.js & rollup -c profiles/production.js\",\n    \"lint\": \"semistandard src/*.js | snazzy\",\n    \"prepublish\": \"npm run build\",\n    \"pretest\": \"npm run build\",\n    \"release\": \"./scripts/release.sh\",\n    \"start\": \"watch 'npm run build' src & http-server -p 5678 -c-1 -o\",\n    \"test\": \"npm run lint && karma start\"\n  }\n}","export {version as VERSION} from '../package.json';\n\nimport L from 'leaflet';\nimport { FeatureManager } from 'esri-leaflet';\n\nexport var FeatureLayer = FeatureManager.extend({\n\n  statics: {\n    EVENTS: 'click dblclick mouseover mouseout mousemove contextmenu popupopen popupclose',\n    CLUSTEREVENTS: 'clusterclick clusterdblclick clustermouseover clustermouseout clustermousemove clustercontextmenu'\n  },\n\n  /**\n   * Constructor\n   */\n\n  initialize: function (options) {\n    FeatureManager.prototype.initialize.call(this, options);\n\n    options = L.setOptions(this, options);\n\n    this._layers = {};\n    this._leafletIds = {};\n\n    this.cluster = L.markerClusterGroup(options);\n    this._key = 'c' + (Math.random() * 1e9).toString(36).replace('.', '_');\n\n    this.cluster.addEventParent(this);\n  },\n\n  /**\n   * Layer Interface\n   */\n\n  onAdd: function (map) {\n    FeatureManager.prototype.onAdd.call(this, map);\n    this._map.addLayer(this.cluster);\n  },\n\n  onRemove: function (map) {\n    FeatureManager.prototype.onRemove.call(this, map);\n    this._map.removeLayer(this.cluster);\n  },\n\n  /**\n   * Feature Management Methods\n   */\n\n  createLayers: function (features) {\n    var markers = [];\n\n    for (var i = features.length - 1; i >= 0; i--) {\n      var geojson = features[i];\n      var layer = this._layers[geojson.id];\n\n      if (!layer) {\n        var newLayer = L.GeoJSON.geometryToLayer(geojson, this.options);\n        newLayer.feature = L.GeoJSON.asFeature(geojson);\n        newLayer.defaultOptions = newLayer.options;\n        newLayer._leaflet_id = this._key + '_' + geojson.id;\n\n        this.resetStyle(newLayer.feature.id);\n\n        // cache the layer\n        this._layers[newLayer.feature.id] = newLayer;\n\n        this._leafletIds[newLayer._leaflet_id] = geojson.id;\n\n        if (this.options.onEachFeature) {\n          this.options.onEachFeature(newLayer.feature, newLayer);\n        }\n\n        this.fire('createfeature', {\n          feature: newLayer.feature\n        });\n\n        // add the layer if it is within the time bounds or our layer is not time enabled\n        if (!this.options.timeField || (this.options.timeField && this._featureWithinTimeRange(geojson))) {\n          markers.push(newLayer);\n        }\n      }\n    }\n\n    if (markers.length) {\n      this.cluster.addLayers(markers);\n    }\n  },\n\n  addLayers: function (ids) {\n    var layersToAdd = [];\n    for (var i = ids.length - 1; i >= 0; i--) {\n      var layer = this._layers[ids[i]];\n      this.fire('addfeature', {\n        feature: layer.feature\n      });\n      layersToAdd.push(layer);\n    }\n    this.cluster.addLayers(layersToAdd);\n  },\n\n  removeLayers: function (ids, permanent) {\n    var layersToRemove = [];\n    for (var i = ids.length - 1; i >= 0; i--) {\n      var id = ids[i];\n      var layer = this._layers[id];\n      this.fire('removefeature', {\n        feature: layer.feature,\n        permanent: permanent\n      });\n      layersToRemove.push(layer);\n      if (this._layers[id] && permanent) {\n        delete this._layers[id];\n      }\n    }\n    this.cluster.removeLayers(layersToRemove);\n  },\n\n  /**\n   * Styling Methods\n   */\n\n  resetStyle: function (id) {\n    var layer = this._layers[id];\n\n    if (layer) {\n      layer.options = layer.defaultOptions;\n      this.setFeatureStyle(layer.feature.id, this.options.style);\n    }\n\n    return this;\n  },\n\n  setStyle: function (style) {\n    this.eachFeature(function (layer) {\n      this.setFeatureStyle(layer.feature.id, style);\n    }, this);\n    return this;\n  },\n\n  setFeatureStyle: function (id, style) {\n    var layer = this._layers[id];\n\n    if (typeof style === 'function') {\n      style = style(layer.feature);\n    }\n    if (layer.setStyle) {\n      layer.setStyle(style);\n    }\n  },\n\n  /**\n   * Utility Methods\n   */\n\n  eachFeature: function (fn, context) {\n    for (var i in this._layers) {\n      fn.call(context, this._layers[i]);\n    }\n    return this;\n  },\n\n  getFeature: function (id) {\n    return this._layers[id];\n  }\n});\n\nexport function featureLayer (options) {\n  return new FeatureLayer(options);\n}\n\nexport default featureLayer;\n"],"names":["featureLayer","options","FeatureLayer","FeatureManager","extend","statics","EVENTS","CLUSTEREVENTS","initialize","prototype","call","this","L","setOptions","_layers","_leafletIds","cluster","markerClusterGroup","_key","Math","random","toString","replace","addEventParent","onAdd","map","_map","addLayer","onRemove","removeLayer","createLayers","features","markers","i","length","geojson","layer","id","newLayer","GeoJSON","geometryToLayer","feature","asFeature","defaultOptions","_leaflet_id","resetStyle","onEachFeature","fire","timeField","_featureWithinTimeRange","push","addLayers","ids","layersToAdd","removeLayers","permanent","layersToRemove","setFeatureStyle","style","setStyle","eachFeature","fn","context","getFeature"],"mappings":"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"}