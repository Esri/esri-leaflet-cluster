{"version":3,"file":"esri-leaflet-cluster-debug.js","sources":["../src/ClusterFeatureLayer.js"],"sourcesContent":["import { setOptions, GeoJSON, markerClusterGroup } from 'leaflet';\r\nimport { FeatureManager } from 'esri-leaflet';\r\nexport { version as VERSION } from '../package.json';\r\n\r\nexport var FeatureLayer = FeatureManager.extend({\r\n\r\n  statics: {\r\n    EVENTS: 'click dblclick mouseover mouseout mousemove contextmenu popupopen popupclose',\r\n    CLUSTEREVENTS: 'clusterclick clusterdblclick clustermouseover clustermouseout clustermousemove clustercontextmenu'\r\n  },\r\n\r\n  /**\r\n   * Constructor\r\n   */\r\n\r\n  initialize: function (options) {\r\n    FeatureManager.prototype.initialize.call(this, options);\r\n\r\n    options = setOptions(this, options);\r\n\r\n    this._layers = {};\r\n    this._leafletIds = {};\r\n\r\n    this.cluster = markerClusterGroup(options);\r\n    this._key = 'c' + (Math.random() * 1e9).toString(36).replace('.', '_');\r\n\r\n    this.cluster.addEventParent(this);\r\n  },\r\n\r\n  /**\r\n   * Layer Interface\r\n   */\r\n\r\n  onAdd: function (map) {\r\n    FeatureManager.prototype.onAdd.call(this, map);\r\n    this._map.addLayer(this.cluster);\r\n  },\r\n\r\n  onRemove: function (map) {\r\n    FeatureManager.prototype.onRemove.call(this, map);\r\n    this._map.removeLayer(this.cluster);\r\n  },\r\n\r\n  /**\r\n   * Feature Management Methods\r\n   */\r\n\r\n  createNewLayer: function (geojson) {\r\n    var layer = GeoJSON.geometryToLayer(geojson, this.options);\r\n    // trap for GeoJSON without geometry\r\n    if (layer) {\r\n      layer.defaultOptions = layer.options;\r\n    }\r\n    return layer;\r\n  },\r\n\r\n  createLayers: function (features) {\r\n    var markers = [];\r\n\r\n    for (var i = features.length - 1; i >= 0; i--) {\r\n      var geojson = features[i];\r\n      var layer = this._layers[geojson.id];\r\n\r\n      if (!layer) {\r\n        layer = this.createNewLayer(geojson);\r\n        layer.feature = GeoJSON.asFeature(geojson);\r\n        layer.defaultOptions = layer.options;\r\n        layer._leaflet_id = this._key + '_' + geojson.id;\r\n\r\n        this.resetStyle(layer.feature.id);\r\n\r\n        // cache the layer\r\n        this._layers[layer.feature.id] = layer;\r\n\r\n        this._leafletIds[layer._leaflet_id] = geojson.id;\r\n\r\n        if (this.options.onEachFeature) {\r\n          this.options.onEachFeature(layer.feature, layer);\r\n        }\r\n\r\n        this.fire('createfeature', {\r\n          feature: layer.feature\r\n        });\r\n      }\r\n\r\n      // add the layer if it is within the time bounds or our layer is not time enabled\r\n      if (!this.options.timeField || (this.options.timeField && this._featureWithinTimeRange(geojson))) {\r\n        markers.push(layer);\r\n      }\r\n    }\r\n\r\n    if (markers.length) {\r\n      this.cluster.addLayers(markers);\r\n    }\r\n  },\r\n\r\n  addLayers: function (ids) {\r\n    var layersToAdd = [];\r\n    for (var i = ids.length - 1; i >= 0; i--) {\r\n      var layer = this._layers[ids[i]];\r\n      this.fire('addfeature', {\r\n        feature: layer.feature\r\n      });\r\n      layersToAdd.push(layer);\r\n    }\r\n    this.cluster.addLayers(layersToAdd);\r\n  },\r\n\r\n  removeLayers: function (ids, permanent) {\r\n    var layersToRemove = [];\r\n    for (var i = ids.length - 1; i >= 0; i--) {\r\n      var id = ids[i];\r\n      var layer = this._layers[id];\r\n      this.fire('removefeature', {\r\n        feature: layer.feature,\r\n        permanent: permanent\r\n      });\r\n      layersToRemove.push(layer);\r\n      if (this._layers[id] && permanent) {\r\n        delete this._layers[id];\r\n      }\r\n    }\r\n    this.cluster.removeLayers(layersToRemove);\r\n  },\r\n\r\n  /**\r\n   * Styling Methods\r\n   */\r\n\r\n  resetStyle: function (id) {\r\n    var layer = this._layers[id];\r\n\r\n    if (layer) {\r\n      layer.options = layer.defaultOptions;\r\n      this.setFeatureStyle(layer.feature.id, this.options.style);\r\n    }\r\n\r\n    return this;\r\n  },\r\n\r\n  setStyle: function (style) {\r\n    this.eachFeature(function (layer) {\r\n      this.setFeatureStyle(layer.feature.id, style);\r\n    }, this);\r\n    return this;\r\n  },\r\n\r\n  setFeatureStyle: function (id, style) {\r\n    var layer = this._layers[id];\r\n\r\n    if (typeof style === 'function') {\r\n      style = style(layer.feature);\r\n    }\r\n    if (layer.setStyle) {\r\n      layer.setStyle(style);\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Utility Methods\r\n   */\r\n\r\n  eachFeature: function (fn, context) {\r\n    for (var i in this._layers) {\r\n      fn.call(context, this._layers[i]);\r\n    }\r\n    return this;\r\n  },\r\n\r\n  getFeature: function (id) {\r\n    return this._layers[id];\r\n  }\r\n});\r\n\r\nexport function featureLayer (options) {\r\n  return new FeatureLayer(options);\r\n}\r\n\r\nexport default featureLayer;\r\n"],"names":["FeatureManager","setOptions","markerClusterGroup","GeoJSON"],"mappings":"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"}