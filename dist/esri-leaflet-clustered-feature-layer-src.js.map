{"version":3,"sources":["../src/ClusteredFeatureLayer.js"],"names":[],"mappings":"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","file":"esri-leaflet-clustered-feature-layer-src.js","sourcesContent":["(function (factory) {\n  // define an AMD module that relies on 'leaflet'\n  if (typeof define === 'function' && define.amd) {\n    define(['leaflet', 'esri-leaflet'], function (L, Esri) {\n      return factory(L, Esri);\n    });\n\n  // define a common js module that relies on 'leaflet'\n  } else if (typeof module === 'object' && typeof module.exports === 'object') {\n    module.exports = factory(require('leaflet'), require('esri-leaflet'));\n  }\n\n  // define globals if we can find the proper place to attach them to.\n  if(window && window.L && window.L.esri) {\n    var ClusteredFeatureLayer = factory(L, L.esri);\n\n    window.L.esri.Layers.ClusteredFeatureLayer = ClusteredFeatureLayer;\n\n    window.L.esri.Layers.clusteredFeatureLayer = function(url, options){\n      return new ClusteredFeatureLayer(url, options);\n    };\n\n    window.L.esri.clusteredFeatureLayer = function(url, options){\n      return new ClusteredFeatureLayer(url, options);\n    };\n\n    window.L.esri.clusteredFeatureLayer = function(url, options){\n      return new ClusteredFeatureLayer(url, options);\n    };\n  }\n}(function (L, Esri) {\n\n  var ClusteredFeatureLayer = Esri.Layers.FeatureManager.extend({\n\n    statics: {\n      EVENTS: 'click dblclick mouseover mouseout mousemove contextmenu popupopen popupclose',\n      CLUSTEREVENTS: 'clusterclick clusterdblclick clustermouseover clustermouseout clustermousemove clustercontextmenu'\n    },\n\n    /**\n     * Constructor\n     */\n\n    initialize: function (url, options) {\n      Esri.Layers.FeatureManager.prototype.initialize.call(this, url, options);\n\n      options = L.setOptions(this, options);\n\n      this._layers = {};\n      this._leafletIds = {};\n\n      this.cluster = new window.L.MarkerClusterGroup(options);\n      this._key = 'c'+(Math.random() * 1e9).toString(36).replace('.', '_');\n\n      // @TODO enable at Leaflet 0.8\n      // this.cluster.addEventParent(this);\n\n      // @TODO remove from Leaflet 0.8\n      this.cluster.on(ClusteredFeatureLayer.EVENTS, this._propagateEvent, this);\n      this.cluster.on(ClusteredFeatureLayer.CLUSTEREVENTS, this._propagateClusterEvent, this);\n    },\n\n    /**\n     * Layer Interface\n     */\n\n    onAdd: function(map){\n      Esri.Layers.FeatureManager.prototype.onAdd.call(this, map);\n      this._map.addLayer(this.cluster);\n    },\n\n    onRemove: function(map){\n      Esri.Layers.FeatureManager.prototype.onRemove.call(this, map);\n      this._map.removeLayer(this.cluster);\n    },\n\n    /**\n     * Feature Managment Methods\n     */\n\n    createLayers: function(features){\n      var markers = [];\n\n      for (var i = features.length - 1; i >= 0; i--) {\n        var geojson = features[i];\n        var layer = this._layers[geojson.id];\n\n        if(!layer){\n          // @TODO Leaflet 0.8\n          //newLayer = L.GeoJSON.geometryToLayer(geojson, this.options);\n\n          var newLayer = L.GeoJSON.geometryToLayer(geojson, this.options.pointToLayer, L.GeoJSON.coordsToLatLng, this.options);\n          newLayer.feature = L.GeoJSON.asFeature(geojson);\n          newLayer.defaultOptions = newLayer.options;\n          newLayer._leaflet_id = this._key + '_' + geojson.id;\n\n          this.resetStyle(newLayer.feature.id);\n\n          // bind a popup if we have one\n          if(this._popup && newLayer.bindPopup){\n            newLayer.bindPopup(this._popup(newLayer.feature, newLayer));\n          }\n\n          // cache the layer\n          this._layers[newLayer.feature.id] = newLayer;\n\n          this._leafletIds[newLayer._leaflet_id] = geojson.id;\n\n          if(this.options.onEachFeature){\n            this.options.onEachFeature(newLayer.feature, newLayer);\n          }\n\n          this.fire('createfeature', {\n            feature: newLayer.feature\n          });\n\n          // add the layer if it is within the time bounds or our layer is not time enabled\n          if(!this.options.timeField || (this.options.timeField && this._featureWithinTimeRange(geojson)) ){\n            markers.push(newLayer);\n          }\n        }\n      }\n\n      if(markers.length){\n        this.cluster.addLayers(markers);\n      }\n    },\n\n    addLayers: function(ids){\n      var layersToAdd = [];\n      for (var i = ids.length - 1; i >= 0; i--) {\n        var layer = this._layers[ids[i]];\n        this.fire('addfeature', {\n          feature: layer.feature\n        });\n        layersToAdd.push(layer);\n      }\n      this.cluster.addLayers(layersToAdd);\n    },\n\n    removeLayers: function(ids, permanent){\n      var layersToRemove = [];\n      for (var i = ids.length - 1; i >= 0; i--) {\n        var id = ids[i];\n        var layer = this._layers[id];\n        this.fire('removefeature', {\n          feature: layer.feature,\n          permanent: permanent\n        });\n        layersToRemove.push(layer);\n        if(this._layers[id] && permanent){\n          delete this._layers[id];\n        }\n      }\n      this.cluster.removeLayers(layersToRemove);\n    },\n\n    /**\n     * Styling Methods\n     */\n\n    resetStyle: function (id) {\n      var layer = this._layers[id];\n\n      if(layer){\n        layer.options = layer.defaultOptions;\n        this.setFeatureStyle(layer.feature.id, this.options.style);\n      }\n\n      return this;\n    },\n\n    setStyle: function (style) {\n      this.eachFeature(function (layer) {\n        this.setFeatureStyle(layer.feature.id, style);\n      }, this);\n      return this;\n    },\n\n    setFeatureStyle: function (id, style) {\n      var layer = this._layers[id];\n\n      if (typeof style === 'function') {\n        style = style(layer.feature);\n      }\n      if (layer.setStyle) {\n        layer.setStyle(style);\n      }\n    },\n\n    /**\n     * Popup Methods\n     */\n\n    bindPopup: function (fn, options) {\n      this._popup = fn;\n      for (var i in this._layers) {\n        var layer = this._layers[i];\n        var popupContent = this._popup(layer.feature, layer);\n        layer.bindPopup(popupContent, options);\n      }\n    },\n\n    unbindPopup: function () {\n      this._popup =  false;\n      for (var i in this._layers) {\n        this._layers[i].unbindPopup();\n      }\n    },\n\n    /**\n     * Utility Methods\n     */\n\n    eachFeature: function (fn, context) {\n      for (var i in this._layers) {\n        fn.call(context, this._layers[i]);\n      }\n      return this;\n    },\n\n    getFeature: function (id) {\n      return this._layers[id];\n    },\n\n    // from https://github.com/Leaflet/Leaflet/blob/v0.7.2/src/layer/FeatureGroup.js\n    //  @TODO remove at Leaflet 0.8\n    _propagateEvent: function (e) {\n      e = L.extend({\n        layer: this._layers[this._leafletIds[e.target._leaflet_id]],\n        target: this\n      }, e);\n      this.fire(e.type, e);\n    },\n\n    _propagateClusterEvent: function (e) {\n      e = L.extend({\n        layer: e.target,\n        target: this\n      }, e);\n      this.fire(e.type, e);\n    }\n  });\n\n  return ClusteredFeatureLayer;\n}));"]}